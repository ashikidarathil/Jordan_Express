<%- include('../partials/user/header') %>

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shop | Your Brand</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap');

    * {
      padding: 0;
      margin: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
      text-decoration: none;
      transition: 0.3s;
    }

    body {
      background-color: #f8f9fa;
      color: #895D39;
    }

    .main {
      display: flex;
      padding-top: 20px;
      padding-left: 110px;
      margin: 0px;
      margin-bottom: 200px;
    }

    .filters {
      margin-top: 215px;
      margin-left: 20px;
      flex: 0 0 250px;
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      height: fit-content;
      margin-bottom: 50px;
    }

    .filter-section {
      margin-bottom: 1.5rem;
      border-bottom: 1px solid #eee;
      padding-bottom: 1.5rem;
    }

    .filter-section:last-child {
      border-bottom: 0;
      margin-bottom: 0;
    }

    .filter-title {
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .filter-title button {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 0.8rem;
      color: #666;
    }

    .filter-title button:hover {
      color: #895D39;
    }

    .checkbox-group {
      font-weight: 700;
      color: #606060;
      font-size: 14px;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .checkbox-item input {
      cursor: pointer;
    }

    .color-options {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .color-option {
      width: 25px;
      height: 25px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid #eee;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .color-option:hover {
      transform: scale(1.1);
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.2);
    }

    .color-option.selected {
      box-shadow: 0 0 0 2px #895D39;
    }

    .price-buttons a {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
      width: 100%;
      flex-wrap: wrap;
      flex-direction: column;
    }

    .price-button {
      flex: 1;
      min-width: calc(25% - 0.5rem);
      padding: 0.5rem;
      border: 1px solid #ddd;
      color: #606060;
      border-radius: 4px;
      background: white;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .price-button:hover {
      background: #f5f5f5;
    }

    .price-button.active {
      background: #895D39;
      color: white;
      border-color: #895D39;
    }

    .products .items {
      display: grid;
      grid-template-columns: repeat(3, 280px);
      gap: 30px;
      padding: 0px;
      margin: 0px;
    }

    .products .items .item {
      position: relative;
      overflow: hidden;
      border: 1px solid lightgray;
      border-radius: 6px;
      background-color: white;
    }

    .products .items .item:hover {
      transform: translateY(-6px);
      box-shadow: 0 6px 20px rgba(137, 93, 57, 0.12);
    }

    .products .items .item img {
      width: 100%;
      margin-bottom: 20px;
    }

    .products .items .item .title-prod {
      color: #111;
      font-size: 20px;
      text-align: center;
    }

    .products .items .item .title-prod:hover {
      color: #895D39;
    }

    .products .items .item .stars {
      margin: 10px 0;
    }

    .products .items .item .stars i {
      color: #ffdc19;
    }

    .products .items .item .price span {
      color: #895D39;
      font-size: 24px;
      font-weight: 600;
      margin-right: 30px;
      cursor: pointer;
    }

    .products .items .item .price del {
      color: #606060;
      font-size: 20px;
      text-decoration: line-through;
    }

    a {
      text-decoration: none;
      color: #895D39;
    }

    .products .items .item .icon-product {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      right: -50px;
      display: flex;
      flex-direction: column;
      transition: right 0.3s ease;
    }

    .products .items .item:hover .icon-product {
      right: 30px;
    }

    .products .items .item .icon-product i {
      width: 40px;
      height: 40px;
      text-align: center;
      line-height: 40px;
      border: 1px solid #1111116e;
      color: #111;
      background-color: #fff;
      font-size: 18px;
      margin-bottom: 10px;
      transition: background-color 0.3s, color 0.3s;
    }

    .products .items .item .icon-product i:hover {
      background-color: #895D39;
      color: #fff;
    }

    /* Responsive grid adjustments */
    @media (max-width: 1200px) {
      .products .items {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 768px) {
      .products .items {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 480px) {
      .products .items {
        grid-template-columns: 1fr;
      }
    }

    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 0;
      margin-bottom: 1rem;
    }

    .sort-options select {
      padding: 0.5rem 1rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      background-color: white;
      cursor: pointer;
    }

    .view-options {
      display: flex;
      gap: 0.5rem;
    }

    .view-btn {
      background: white;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 0.5rem;
      cursor: pointer;
      transition: background 0.2s;
    }

    .view-btn:hover {
      background-color: #f0f0f0;
    }

    .view-btn.active {
      background-color: #895D39;
      color: white;
      border-color: #895D39;
    }

    .pagination {
      display: flex;
      justify-content: center;
    }

    .pagination .page-item {
      margin-bottom: -120px;
      margin-top: 60px;
    }

    .pagination .page-link {
      padding: 8px 16px;
      border: 1px solid #ddd;
      border-radius: 3px;
      color: #555;
      text-decoration: none;
      transition: all 0.3s ease;
    }

    .pagination .page-link:hover {
      background-color: #895D39;
      color: white;
      border-color: #895D39;
    }

    .page-item {
      list-style: none;
    }

    .page-link {
      padding: 0.5rem 1rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      color: #895D39;
      text-decoration: none;
      transition: background-color 0.3s, color 0.3s;
    }

    ul.size-list {
      list-style-type: none;
      padding: 0;
      margin: 0;
    }

    ul.size-list li {
      padding: 5px 0;
      border-bottom: 1px solid #ddd;
    }

    ul.size-list li:last-child {
      border-bottom: none;
    }

    @media (max-width: 768px) {
      main {
        flex-direction: column;
      }

      .filters {
        flex: 0 0 auto;
        width: 100%;
      }

      .products .items .item {
        width: 48%;
      }
    }
  </style>

</head>

<div class="container">
  <div class="main">

    <!-- Filters Sidebar -->
    <aside class="filters">
      <div class="filter-section">
        <div class="filter-title">
          <span>Categories</span>
          <button id="clearFilters">Clear</button>
        </div>
        <div class="checkbox-group">
          <%for(let i=0;i< category.length;i++){%>
            <label class="checkbox-item">
              <input type="checkbox" value="<%= category[i]._id %>" class="category-filter">
              <%= category[i].name %>
            </label>
            <%}%>
        </div>
      </div>

      <div class="filter-section">
        <div class="filter-title">
          <span>Price Range</span>
        </div>
        <div class="price-buttons">
          <a href="/filterPrice?gt=0&lt=50"><button class="price-button">$0 - $50</button></a>
          <a href="/filterPrice?gt=50&lt=100"><button class="price-button">$50 - $100</button></a>
          <a href="/filterPrice?gt=100&lt=150"><button class="price-button">$100 - $150</button></a>
          <a href="/filterPrice?gt=150&lt=200"><button class="price-button">$150 - $200</button></a>
        </div>
      </div>

      <!-- New Sorting Options Section -->
      <div class="filter-section">
        <div class="filter-title">
          <span>Sort By</span>
          <button id="clearSorting">Clear</button>
        </div>
        <div class="checkbox-group">
          <label class="checkbox-item">
            <input type="checkbox" name="sort" value="featured" class="sort-filter">
            Featured
          </label>
          <label class="checkbox-item">
            <input type="checkbox" name="sort" value="price-low" class="sort-filter">
            Price: Low to High
          </label>
          <label class="checkbox-item">
            <input type="checkbox" name="sort" value="price-high" class="sort-filter">
            Price: High to Low
          </label>
          <label class="checkbox-item">
            <input type="checkbox" name="sort" value="rating" class="sort-filter">
            Customer Rating
          </label>
          <label class="checkbox-item">
            <input type="checkbox" name="sort" value="newest" class="sort-filter">
            Newest Arrivals
          </label>
        </div>
      </div>
    </aside>

    <div class="products">
      <div class="toolbar" style="margin-left: 100px;margin-right: -50px;">
        <div class="results-count"></div>
      </div>

      <div class="top-sec" style=" display: flex; gap: 100px; align-items: center;justify-content: center; margin-left: 120px;">
        <h3>Featured Products</h3>
      </div>
      <div class="contnaier">
        <div class="items">
          <% for(let i=0; i < products.length; i++) { %>
            <div class="item">
              <a href="/productDetails?id=<%=products[i]._id %>">
                <img src="uploads/product-image/<%= products[i].productImage[0] %>" alt="<%= products[i].productName %>">
              </a>
              <div class="product-desc">
                <a href="#" class="title-prod">
                  <%= products[i].productName %>
                </a>
                <div class="stars">
                  <i class="fa-solid fa-star"></i>
                  <i class="fa-solid fa-star"></i>
                  <i class="fa-solid fa-star"></i>
                  <i class="fa-solid fa-star"></i>
                  <i class="fa-solid fa-star-half-stroke"></i>
                </div>
                <div class="price">
                  <span>$<%= products[i].salePrice %></span>
                  <del>$<%= products[i].regularPrice %></del>
                </div>

                <div class="icon-product">
                  <a href="#"><i class="fa-regular fa-heart"></i></a>
                  <a href="#"><i class="fa-solid fa-cart-shopping"></i></a>
                  <a href="#"><i class="fa-solid fa-right-left"></i></a>
                </div>
              </div>
            </div>
            <%}%>
        </div>
      </div>

      <nav aria-label="Page navigation">
        <ul class="pagination" style="margin-left: 130px;padding: 20px 0px;">
          <% if (currentPages> 1) { %>
            <li class="page-item">
              <a class="page-link" href="/shop?page=<%= currentPages - 1 %>&search=<%= search %>" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            <% } %>

              <% for (let i=1; i <=totalPages; i++) { %>
                <li class="page-item <%= currentPages === i ? 'active' : '' %>">
                  <a class="page-link" href="/shop?page=<%= i %>&search=<%= search %>">
                    <%= i %>
                  </a>
                </li>
                <% } %>

                  <% if (currentPages < totalPages) { %>
                    <li class="page-item">
                      <a class="page-link" href="/shop?page=<%= currentPages + 1 %>&search=<%= search %>" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                      </a>
                    </li>
                    <% } %>
        </ul>
      </nav>
    </div>
  </div>
</div>



<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Category Filter Logic
    const categoryCheckboxes = document.querySelectorAll('.category-filter');
    const urlParams = new URLSearchParams(window.location.search);
    const categoryParam = urlParams.get('category');

    if (categoryParam) {
      const selectedCategories = categoryParam.split(',');
      categoryCheckboxes.forEach(checkbox => {
        if (selectedCategories.includes(checkbox.value)) {
          checkbox.checked = true;
        }
      });
    }

    categoryCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', function () {
        const selectedCategories = [];
        document.querySelectorAll('.category-filter:checked').forEach(checked => {
          selectedCategories.push(checked.value);
        });

        if (selectedCategories.length > 0) {
          window.location.href = '/filter?category=' + selectedCategories.join(',');
        } else {
          window.location.href = '/shop';
        }
      });
    });

    // Sorting Filter Logic
    const sortCheckboxes = document.querySelectorAll('.sort-filter');
    const sortParam = urlParams.get('sort');

    if (sortParam) {
      sortCheckboxes.forEach(checkbox => {
        if (checkbox.value === sortParam) {
          checkbox.checked = true;
        }
      });
    }

    sortCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', function () {
        // Uncheck other sort options (radio button behavior)
        if (this.checked) {
          sortCheckboxes.forEach(cb => {
            if (cb !== this) cb.checked = false;
          });
          
          // Get all current URL parameters
          const currentParams = new URLSearchParams(window.location.search);
          
          // Update or add the sort parameter
          currentParams.set('sort', this.value);
          
          // Remove page parameter to go back to first page
          currentParams.delete('page');
          
          // Build new URL
          let newUrl = '/shop?';
          currentParams.forEach((value, key) => {
            newUrl += `${key}=${value}&`;
          });
          
          // Remove trailing & if exists
          newUrl = newUrl.replace(/&$/, '');
          
          window.location.href = newUrl;
        } else {
          // If unchecking the current sort option, remove sort parameter
          const currentParams = new URLSearchParams(window.location.search);
          currentParams.delete('sort');
          
          let newUrl = '/shop?';
          currentParams.forEach((value, key) => {
            newUrl += `${key}=${value}&`;
          });
          
          newUrl = newUrl.replace(/&$/, '');
          window.location.href = newUrl;
        }
      });
    });

    // Clear Filters Button
    document.getElementById('clearFilters').addEventListener('click', function () {
      document.querySelectorAll('.category-filter').forEach(checkbox => {
        checkbox.checked = false;
      });
      window.location.href = '/shop';
    });

    // Clear Sorting Button
    document.getElementById('clearSorting').addEventListener('click', function () {
      document.querySelectorAll('.sort-filter').forEach(checkbox => {
        checkbox.checked = false;
      });
      
      // Remove sort parameter from URL
      const currentParams = new URLSearchParams(window.location.search);
      currentParams.delete('sort');
      
      let newUrl = '/shop?';
      currentParams.forEach((value, key) => {
        newUrl += `${key}=${value}&`;
      });
      
      newUrl = newUrl.replace(/&$/, '');
      window.location.href = newUrl;
    });
  });
</script>
</body>

</html>

<%- include('../partials/user/footer') %>